'------------------------------------------------------------------------------
' Evaluar, Compilar y colorear código                               (26/Sep/20)
'
' Editor de múltiples ficheros con opciones de editor de código
'
' Con opciones de compilación:
'   Compilar y ejecutar
'   Compilar (build)
'   Evaluar el código.
' Colorear el código (en el editor) y en formato HTML.
'
'   Al colorear y compilar/evaluar se muestra:
'       las palabras clave o los errores producidos al compilar
'
' Funciones generales de edición de texto:
'   Buscar y reemplazar
'   Poner y quitar comentarios
'   Poner y quitar indentación
'   Convertir a mayúsculas, minúsculas y título
'   Clasificar el texto
'   Quitar espacios de delante, detrás y todos los espacios
'   Poner y quitar palabras delante y detrás de cada línea seleccionada
' Navegación y marcadores (bookmarks)
'   Opción de navegar adelante y atrás en los sitios en que se ha estado de cada fichero
'   Opción de poner/quitar marcadores
'       ir al siguiente y anterior,
'       tanto en el fichero actual como en todos los ficheros
'
'------------------------------------------------------------------------------
'
' Uniendo los proyectos: gsEvaluarColorearCodigoNET y gsCompilarEjecutarNET
' sin usar gsColorearNET ni gsCompilarNET usadas en gsCompilarEjecutarNET
'
'/# Comentarios de los proyectos antes de la unificación
'
' ColorearSyntaxTree con código de Visual Basic                     (20/Sep/20)
'   renombrado a gsEvaluarColorearCodigoNET
'
' Abrir un fichero de Visual Basic o C#
' Si se compila mostrará los errores que haya, si no, colorea el resultado
' Si no se compila colorea el resultado
' Para .NET 5.0 (inicialmente para .NET Core 3.1)
'
' Empecé usando las clases (adaptadas) de CSharpToVB (Visual Basic) de Paul1956:
'           https://github.com/paul1956/CSharpToVB
' Pero las he reducido (dejado de usar) y las que he dejado es con cambios;
'   Para colorear:
'       Con cambios:    ColorizeSupport.vb (en Compilar.vb)
'
' gsCompilarEjecutarNET                                             (08/Sep/20)
' Utilidad para colorear, compilar y ejecutar código de VB o C#
'
'v1.0.0.9   Opciones de Buscar y Reemplazar.
'           Pongo WordWrap del RichTextBox a False para que no corte las líneas.
'v1.0.0.10  Con panel para buscar y reemplazar y
'           funciones para buscar, buscar siguiente, reemplazar y reemplazar todos.
'           También en el menú de edición están las 5 opciones.
'v1.0.0.11  Nueva opción para compilar sin ejecutar y otras mejoras visuales.
'v1.0.0.12  Se puede indicar la versión de los lenguajes.
'           Se usa Latest para VB y Default (9.0) para C#.
'v1.0.0.13  Añado un menú contextual al editor de código con los comandos de edición.
'v1.0.0.14  Quito la clase gsColorearNET y uso los módulos ColorizeSupport, etc.
'
'/#
'
'
'v1.0.0.9   27/Sep/20   Haciendo operativa la unión de las dos aplicaciones
'v1.0.0.10  28/Sep/20   Algunos cambios en colorear HTML para quitar los <br>&nbsp;
'v1.0.0.11              Nuevas cosillas
'v1.0.0.12              Acepta Drag & Drop, pone quita comentarios e indentación
'                       arreglo que los nombres de los ficheros no se pusieran al principio
'                       asigno el estado habilitado/deshabilitado de los menús y botones
'v1.0.0.13  29/Sep/20   Usar marcadores en el código
'                       Al buscar/reemplazar, poder buscar tabs y returns (\t y \r)
'                       En la búsqueda/reemplazo se indicarán \t o \r para buscar vbTab y vbCr
'                       Se guarda la visibilidad de las barras de herramientas
'v1.0.0.14              Uso la imagen "bookmark_003_8x10.png" para indicar que hay un marcador
'v1.0.0.15  30/Sep/20   Recortes para lo último copiado y usarlos para pegar (Ctrl+Shift+V)
'v1.0.0.16              Arreglando el bug al reemplazar siguiente y no hay más coincidencias
'v1.0.0.17              Arreglando al seleccionar el lenguaje
'                       Nuevas pestañas en la ventana de opciones y arreglo bug al eliminar/ordenar
'                       usando los botones.
'                       A día de hoy estas son las pestañas y opciones:
'                       General: Cargar al iniciar, colorear al cargar, mostrar líneas al colorear HTML,
'                                Al evaluar colorear y compilar el código.
'                       Ficheros recientes (eliminarlos)
'                       Colores y fuente: Fuente, Tamaño, indentación
'                       Buscar/reemplazar: textos de buscar y reemplazar, Comprobar Case y palabra completa
'                       Edición: recortes de edición (eliminarlos)
'v1.0.0.18              Arreglando que se vaya a otro sitio al escribir, que no quita los comentarios...
'                       Lo de que no se posicionase bien era al poner los marcadores... cambiaba el SelectionStart
'                       Captura doble pulsaciones de teclas: CtrlK+CtrlK, CtrlK+CtrlL, CtrlK+CtrlC, CtrlK+CtrlU
'v1.0.0.19  01/Oct/20   Ajustar la altura del panelHerrmientas según se muestre o no el panel de buscar
'                       por ahora no compruebo el resto de paneles.
'                       No sé si arreglar las posiciones de los bookmarks si cambia el texto...
'                       ya que si se quitan o ponen líneas, se ajustan a la posición que tenían antes, no a la nueva
'v1.0.0.20              Clasificar el texto seleccionado. Captura Shit+AltL, Shit+Alt+S (lo añado al menú Editor)
'                       Añado el menú Editor (con los mismos comandos que toolStripEditor)
'v1.0.0.21              El alto del panel de herramientas se ajusta correctamente
'                       tanto al mostrar/ocultar los paneles como al cambiar el tamaño del Form1
'v1.0.0.22              Añado las opciones de clasificar al formulario de opciones
'v1.0.0.23              Añado las opciones de cambiar de mayúsculas a minúsculas, etc. al menú Editor
'                       Creo métodos de extensión para las funciones del cambio de "case"
'                       En GuardarComo pongo que siempre muestre el cuadro de diálogo de guardar
'                           antes hacía una comprobación de solo mostrarlo si el nombre era distinto al
'                           usado cuando se abrió.
'v1.0.0.24              Arreglado que cambie el lenguaje cuando se selecciona del buttonLenguaje
'                       Al crear nuevo fichero, mostrar los valores de posición y tamaño
'                       Al cerrar el formulario, no preguntar si se guarda si no hay texto
'v1.0.0.25  02/Oct/20   Los valores de comparar los guardo directamente en las propiedades compartidas
'                       de la clase CompararString.
'v1.0.0.26              Cambios en Compilar.ColorearHTML lo simplifico,
'                           pero quito lo de poner números de línea (puesto nuevamente)
'                       Pongo nuevamente que se guarden MaxFicsConfig (50) (se muestran en el combo de los ficheros)
'                       pero se muestren en el menú recientes solo los indicados en MaxFicsMenu (9)
'v1.0.0.27              Cambios en Compilar.ColorearHTML para corregir el fallo en la documentación HTML.
'v1.0.0.28              Muestro el número de palabras que tiene el fichero.
'v1.0.0.29              Añado shortcuts a las opciones de mayúsculas/minúsculas
'v1.0.0.30              Si el texto está todo en mayúsculas, al cambiarlo a Título se pegunta antes.
'                           más que nada porque la función no lo cambia si está todo en mayúsculas
'                           y al pulsar en cambiar a título no hacía nada...
'                           pregunto para que no parezca que no funciona :-)
'v1.0.0.31              Al guardar mostrar solo el nombre si el directorio es Documentos
'v1.0.0.32              Al cerrar si no está guardado, dar la oportunidad de cancelar
'                       y ahora, si tiene nombre, no pregunta por el nombre y lo guarda.
'v1.0.0.33              Opciones para quitar los espacios delante, detrás y ambos.
'v1.0.0.34              Al pulsar Intro poner los espacios de indentación como esté la línea anterior
'                           por ahora añade una línea de más...
'v1.0.0.35              Al pulsar ENTER en el combo de buscar, empezar la búsqueda (no empieza)
'v1.0.0.36              Solucionado (al estilo McGiver) el pulsar ENTER para que no añada 2 líneas.
'v1.0.0.37              Solucionado que al pulsar RNTER en el combo buscar siga buscando
'                           (había que usar el evento KeyUp)
'v1.0.0.38  03/Oct/20   Añado el método Compilar.ColoreaSeleccionRichTextBox para colorear solo
'                       el texto seleccionado, para usar si colorearAlCargar o colorearAlEvaluar, en:
'                           cambiar mayúsculas/minúsculas, poner/quitar indentación y comentarios
'v1.0.0.39              Cambio de sitio la forma de saber si deben estar habilitados los botones visibles
'v1.0.0.40              Arreglando poner y quitar indentación para que vaya bien en todos los casos
'v1.0.0.41              Arreglando poner y quitar comentarios
'v1.0.0.42              Arreglado clasificar selección y quitar espacios, etc.
'v1.0.0.43              Arreglado fallo en Compilar.ColorearHTML usando ReplaceWord en vez de Replace
'                       porque se encontraba con "col2 y cambiaba el col de color en "<span color="
'v1.0.0.44              Sigue fallando si se usa color en minúsculas, lo cambia...
'                           no cambia COLOR, ni Color (o cualquier cosa que no sea "color") ya que
'                           ReplaceWord distingue entre mayúsculas y minúsculas.
'v1.0.0.45              Arreglando si en el código hay &lt;span> o &lt;b>
'v1.0.0.46              Algunas veces no se ve el richTextBoxCodigo completo
'                           Ni idea de porqué pasó...
'v1.0.0.47              La fuente de richTextBoxSyntax no se cambia, se deja en el tamaño asignado en el diseñador
'v1.0.0.48              Nuevo formato para mostrar los errores y warnings
'v1.0.0.49              Al pulsar en richTextBoxSyntax averiguar la línea y caracter del error
'v1.0.0.50  04/Oct/20   Seleccionar la línea clickeada
'v1.0.0.51              Al pulsar en richTextBoxSyntax selecciona la posición completa del error
'v1.0.0.52              ReplaceWord no distingue entre mayúsculas y minúsculas: StringComparison.OrdinalIgnoreCase
'v1.0.0.53              Añado a Extensiones.ReemplazarSiNoEsta para reemplazar si no está lo que se quiere reemplazar
'                           Ejemplo: si busca private y quiere cambiar por <span color:#0000FF>private</span>
'                                    se comprueba que no esté por lo que se quiere cambiar.
'v1.0.0.54              Al pegar texto, colorear lo pegado.
'v1.0.0.55              Hacer lo mismo con pegar recortes. De paso soluciono una cosa y añado otra :-)
'v1.0.0.56              Cambiar la forma del cursor del richTextBoxSyntax (he puesto Hand)
'v1.0.0.57              Pongo barraHerramientasContext como menú contextual del formulario
'v1.0.0.58              
'v1.0.0.59              Añado la clase DiagClassifSpanInfo y la uso como parte del valor devuelto por
'                       Compilar.EvaluaCodigo tipo: Dictionary(Of String, Dictionary(Of String, List(Of DiagClassifSpanInfo)))
'v1.0.0.60  05/Oct/20   Poner un ListBox en vez de richTextBoxSysntax para acceder a la posición de
'                       los errores o de las definiciones del código.
'v1.0.0.61              Cambio DiagClassifSpanInfo por dos clases: DiagInfo y ClassifiedSpanInfo
'                       Compilar.EvaluaCodigo usa: Dictionary(Of String, Dictionary(Of String, List(Of ClassifSpanInfo)))
'                       DiagInfo para los errores de compilación
'                       ClassifSpanInfo para la evaluación del código
'                       Al pulsar en un elemento en el ListBox (de cualquiera de los dos tipos)
'                       se selecciona el texto relacionado.
'v1.0.0.62              Quito el control richTextBoxSyntax
'v1.0.0.63              Añado menú en Herramientas para ocultar el panel de evaluación
'v1.0.0.64              Al abrir el menú de herramientas no se muestran habilitados correctamente
'v1.0.0.65              menuOcultarEvaluar sirve para ocultar o mostrar el panel de evaluación
'                       no estará habilitado si no hay datos que mostrar
'v1.0.0.66              Al compilar o ejecutar, etc. borrar antes la lista de evaluación
'v1.0.0.67              Al evaluar el código en las claves, no se hace distinción entre mayúsculas y minúsculas
'                       CompararString implementa IEqualityComparer(Of String)
'                       para usar con Contains en Compilar.EvaluaCodigo.
'v1.0.0.68              Quito el drawMode del listbox para que NO dibuje los items,
'                       algunas veces da error de memoria
'v1.0.0.69              Asigno DrawMode a owner draw cuando se carga la lista, después lo pongo en normal
'                       pero esto NO repinta (no llama al método DrawItem) los items
'v1.0.0.70              Pruebo varias cosas a ver si se repintan, pero nada...
'v1.0.0.71              A ver si con un timer...
'                       lo deja pintado durante lo que dura el timer... pero después los pone normal
'v1.0.0.72              Pongo el código de DrawItem dentro de un Try/Catch y quito el timer
'                       parece que va bien...
'v1.0.0.73              Si da error, lo añado al listbox... por comprobar... (parece que va bien así)
'v1.0.0.74              Clasifico las palabras clave mostradas.
'v1.0.0.75              Solo hay un elemento del tipo ClassifSpanInfo en cada palabra clave (uso un List(of ClassifSpanInfo))
'                       si no voy a poner todas las palabras (no vale la pena llenar la lista),
'                       el tipo devuelto por EvaluaCodigo debería ser: Dictionary(Of String, Dictionary(Of String, ClassifSpanInfo))
'v1.0.0.76              El error lo ha dado como DiagnosticSeverity.Hidden
'v1.0.0.77              Pongo el panel de evaluación más pequeño (*.2 en vez de *.3)
'v1.0.0.78              Al comentar líneas, lo hace donde empieza el texto, no al principio de la línea
'v1.0.0.79              Pongo el panel de evaluación a *.25
'v1.0.0.80              Arreglado al indentar (lo mismo tenía TAB) se come cosas de después, selecciona algo más
'v1.0.0.81              Guardar la selección del último fichero y ponerla al abrirlo...
'v1.0.0.82              Al cargar o guardar cambiar los TAB por 8 espacios. Puesto como opción
'v1.0.0.83              Publicado en GitHub
'v1.0.0.84  06/Oct/20   Al pulsar HOME que se vaya al primer carácter no espacio o TAB, no al principio.
'
'v1.0.0.85  08/Oct/20   Pensando cómo hacer lo de tener múltiples ficheros: ¿MDI o ventanas independientes?
'v1.0.0.86              Cambio ident. por palab. al mostrar los caracteres y palabras del texto.
'v1.0.0.87              Mostrar .txt al abrir y guardar, y si se colorea al cargar, no hacerlo si no es .vb o .cs
'                       Las extensiones mostradas para Texto: .txt, .log y .md
'                       Añado nueva opción al botón de lenguaje: txt / Texto
'v1.0.0.88              Si es texto no compilar, evaluar, etc. (las opciones estarán deshabilitadas)
'v1.0.0.89              En Abrir y Guardar ahora se comprueba si la extensión es .vb, .cs u otra
'                       para asignar la imagen y el texto del botón lenguaje.
'                       Ya no se comprueba si el código tiene instrucción de VB o C#, ya que si la extensión
'                       no es la que corresponde, se considera Texto.
'v1.0.0.90              Opciones para poner y quitar texto del final de las líneas.
'                       O las seleccionadas o la actual.
'v1.0.0.91              Al pulsar HOME si está en la posición 1 (segundo carácter) no se va al primero
'v1.0.0.92              Comprobar si en el resto de opciones de poner / quitar se debe usar:
'                       Dim lineas() As String = richTextBoxCodigo.SelectedText.TrimEnd(ChrW(13)).Split(vbCr.ToCharArray)
'                       En lugar de sin el .TrimEnd(ChrW(13))
'v1.0.0.93              Usando un formulario MDI
'v1.0.0.94              Si se abre desde MDI.Nuevo no cargar el último fichero
'v1.0.0.95              Nuevas opciones en el menú ventana para maximiar y restaurar el tamaño de las ventanas hijas
'                       Al abrir desde el MDI que elija el fichero a cargar
'v1.0.0.96  09/Oct/20   Asigno el tamaño mínimo para el MDI
'v1.0.0.97              Creo el módulo UtilFormEditor con las opciones de manejar el contenido de los richtextboxs
'                       richTextBoxCodigo y richTextBoxLineas
'v1.0.0.98              Asignando nuevos valores a UtilFormEditor para acceder a:
'                       el form1 activo, el mdi
'v1.0.0.99              Paso casi todos los menús y controles a UtilFormEditor
'v1.0.0.100             Quito el toolbar y casi todos los menús del MDI
'v1.0.0.101             Todos los controles, menús, etc. están en los formularios que corresponden.
'                       Solo queda ir probando...
'v1.0.0.102             Arreglar el tamaño del form1 según se muetren las herramientas.
'v1.0.0.103 10/Oct/20   Paso los eventos de los controles que hay en Form1 al Form1
'v1.0.0.104             Quito de UtilFormEditor las declaraciones de los menús y botones
'                       y cuando se acceden uso CurrentMDI
'v1.0.0.105             Parece que no hace caso a las opciones de mostrar / ocultar los paneles
'v1.0.0.106             Paso todos los eventos del richTextBoxCodigo al Form1
'                       Paso HabilitarBotones al MDI
'v1.0.0.107             Ya hace caso de las opciones de los menús, etc.
'v1.0.0.108             Arreglando el tamaño del form1 al mostrar/ocultar las barras de herramientas
'                       y al maximizarlo
'v1.0.0.109             Al activarse la ventana, ajustar el lenguaje mostrado en buttonLenguaje
'                       y demás valores de las etiquetas... 
'v1.0.0.110             Quito el status del MDI y lo pongo en el form1
'v1.0.0.111             Pongo el Dock: top al panel de herramientas y al maximizar se ven bien los form1
'v1.0.0.112             Arreglar el tamaño y posición del form1 cuando no está maximizado
'v1.0.0.113             Aún hay que arreglar que muestre el nombre del fichero del form1 activo
'v1.0.0.114             Al activar la ventana cambiar el texto de la ventana MDI
'v1.0.0.115             Se resiste el mostrar el Form1 en tamaño normal...
'v1.0.0.116             Vamos mejorando...
'v1.0.0.117             Ya se ajusta bien el tamaño del form1, esté o no maximizado
'v1.0.0.118             Ajustar el texto de la ventana MDI (la he dejado con Editor de código)
'v1.0.0.119             Cuando no estén maximizados los Form1 mostrar el Form1.Text entre corchetes
'                       que es como lo hace cuando están maximizadas
'v1.0.0.120             Al MDI le pongo el título de application.ProductName
'v1.0.0.121             A ver si ahora... (se muestran dos nombres...)
'v1.0.0.122             Al maximizar las ventanas (o ponerlas normal) cambio el título del MDI al predeterminado
'v1.0.0.123 11/Oct/20   Añado el menú de pegar recortes,
'                       pongo un timer para comprobar el portapapeles, se ejecuta cada 30 segundos
'v1.0.0.124             Cambio el intervalo de timerClipBoard a 15 segundos (que se quedan cosas sin copiar)
'v1.0.0.125             Pongo los valores de AutoScaleDimensions a 6, 13
'                       (estaban a 7,15 y en VS no preview cambia la cosa, al menos con FormRecortes)
'v1.0.0.126 13/Oct/20   La ventana de recortes se puede mover pulsando en:
'                       la barra de títulos y la etiqueta Recortes.
'v1.0.0.127 14/Oct/20   Actualizado el Visual Studio y .NET 5.0 RC2
'v1.0.0.128 15/Oct/20   El diseñador de formularios no va... falta la referencia a System.Windows.Forms
'v1.0.0.129             Era que en TargetFramework hay que usar net5.0-windows, pero estaba en net5.0.
'v1.0.0.130 16/Oct/20   Poner en Nuevo que siempre abra una nueva ventana
'v1.0.0.131             Variables a nivel de Form1: codigoNuevo, codigoAnterior y TextoModificado
'v1.0.0.132             Comprobar porqué no se muestra actualizado el nombre de la ventana en
'                       el menú ventanas... solucionado con el evento menuVentana.DropDownOpening
'v1.0.0.133             Ya se muestra el texto en la ventana nueva, era porque se asignaba nombreFichero
'                       y estaba vacío
'v1.0.0.134             Cambio de sitio el menú Editor (estaba después de Editar)
'                       Añado opción de Guardar todos
'v1.0.0.135             Al ejecutar guardar pero no tener en cuenta el nombre de comboFileName
'                       si no el del nombre del fichero del formulario activo.
'v1.0.0.136             Se guardan los nombres de todos los ficheros abiertos
'                       al cargar la aplicación, si cargarUltimo es true, se abren todas las ventanas
'v1.0.0.137             Uso un timer en el evento load del MDI para que se muestre (espero)
'                       el formulario mientras carga los ficheros.
'                       La carga de los últimos formularios la pongo al final de LeerConfig
'v1.0.0.138             Ya no es necesario cargar el último fichero, se carga con nombresUltimos
'v1.0.0.139             Si en la línea de comandos se indica un fichero, si hay varias ventanas abiertas
'                       se abrirá en nueva ventana, si no, en la predeterminada.
'v1.0.0.140             Muestro una ventana de progreso mientras se cargan los últimos ficheros
'                       La ventana siempre estará encima (usando form.TopMost = True)
'v1.0.0.141             Creo el método OnProgreso para llamarlo desde Abrir(fic) y ColorearCodigo
'v1.0.0.142 17/Oct/20   Pongo la ventana de progreso en guardar y guardar todo
'                       Al llamar a OnProcesando se devuelve el porcentaje hecho.
'v1.0.0.143             Mostrar info de la apliciación después de iniciarse.
'v1.0.0.144             Al ejecutar el programa, que la ventana de dotnet se centre en la pantalla
'v1.0.0.145             Pero no hay forma... seguramnente estará minimizada
'v1.0.0.146             Comprobaciones por si al compilar la DLL está siendo usada por otro proceso
'v1.0.0.147             Más pruebas para ver si consigo que se vea la ventana de dotnet
'                       Usando StarInfo en vez de ejecutar directamente.
'                       (cuando tenga de nuevo el monitor comprobaré si es que estaba fuera de rango)
'v1.0.0.148             No muestra los caracteres ni las palabras al cargar desde el inicio
'                       En el último fichero no lo muestra... ???
'v1.0.0.149             Pongo de nuevo el código en Compilar para posicionar la ventana de dotnet.
'                       nada de nada... 
'v1.0.0.150             Quitar el pitido al pulsar ENTER en el editor
'v1.0.0.151             Solucionado que no se mostrara el tamaño y posición de la última ventana
'                       se mostraba los valores "cero" despoués de Inicializar
'v1.0.0.152             Al seleccionar del menú Ficheros>Recientes abrirlo en nueva ventana
'                       si ya está abierto en una de las ventanas, mostrarla.
'v1.0.0.153             El título y el nombre del último fichero de Form1 siempre con el path completo
'v1.0.0.154             Efecto del texto en gris para Buscar y Reemplazar
'v1.0.0.155             Arreglado BUG al buscar, cuando no se encuentra lo buscado
'v1.0.0.156             Se muestra un mensaje de no hallado al buscar o reemplazar
'v1.0.0.157             Se leen y guardan los nombres de los últimos ficheros si no están en blanco
'v1.0.0.158 18/Oct/20   Ajustes en el color del texto de buscar y reemplazar
'                       se muestra Buscar... o Reemplazar... cuando no hay texto, aunque esté en foco
'v1.0.0.159             Al cargar los ficheros, cambia el número del total en la barra de títulos
'                       de la barra de progreso de carga... ¡y no sé porqué!
'v1.0.0.160             Al usar una variable en vez de nombresUltimos.Count va bien
'v1.0.0.161             Pero todos menos el último tienen el mismo nombre (antes también pasaba)
'v1.0.0.162             Cambio la ubicación el fichero de configuración de las ventanas
'                       ahora están en <Ventanas> antes en <Ficheros> y se ve que se liaba con tantos datos
'v1.0.0.163             GuardarConfig lo pongo al cerraqr el MDI (antes estaba al cerrar el Form1)
'v1.0.0.164             Mejora al escribir donde hay texto predeterminado (grisáceo)
'v1.0.0.165             Mostrar por sepado el toolStrip de buscar, no mostrar Reemplazar cuando sea Buscar
'                       Al Reemplazar, mostrar buscar y reemplazar.
'v1.0.0.166 19/Oct/20   Al quitar los comentarios en varias líneas, solo quita a la primera
'                       Es porque ahora en vez de vbCr pone como cambio de línea vbLf
'v1.0.0.167             Creo la función ComprobarFinLinea para saber qué carácter se ha usado.
'v1.0.0.168             Al cerrar una ventana quitar de nombresUltimos el de esa ventana
'v1.0.0.169             Cambio solo seleccionable al comboBoxFileName
'                       Al pulsar ENTER se abre el fichero seleccionado en nueva ventana
'v1.0.0.170             Al pulsar ENTER en Reemplazar, se reemplazará la siguiente
'v1.0.0.171             Quito el comboBoxFileName y uso la colección UltimosFicherosAbiertos
'                       para tener la lista de los últimos ficheros abiertos
'v1.0.0.172             Quito los argumentos (que se pueden quitar) de los métodos de evento
'                       de Form1 y MDIPrincipal
'v1.0.0.173             Pongo ComprobarFinLinea en ColorearHTML
'v1.0.0.174             Al cargar el fichero en la ventana, asignar a Text el nombre sin path
'v1.0.0.175             Al abrir (seleccionando) cargar en nueva ventana, no en la activa
'v1.0.0.176 20/Oct/20   Añado texto más descriptivos a los botones de los ficheros
'v1.0.0.177             Le quito el Tooltip a los menús de ficheros
'v1.0.0.178             Al abrir seleccionando que lo añada a las últimas ventanas
'v1.0.0.179             Ahora añade el path completo al título del Form1 ???
'                       Se ve que es el comportamiento normal del menú automático de las ventanas
'v1.0.0.180             En el menú DropDownOpening le asigno el texto adecuado
'                       pero al activar una de las ventanas le asigna el nombre completo ???
'v1.0.0.181             Asignaba el nombre completo en Form1_Activate... en fin...
'v1.0.0.182             Poner bien el texto del menú mostrar/ocultar panel de evaluación
'                       Al abrir el fichero, se oculta y se limpia el listSyntax
'v1.0.0.183             UltimasVentanasAbiertas debe tener siempre el path completo
'v1.0.0.184             Al guardar las últimas ventanas, guardaba 1 menos
'v1.0.0.185             Poner un botón para mostrar el panel de evaluación (y ponerle imagen)
'v1.0.0.186             El evento Click del menú y botón de ocultar/mostrar panel
'                       los pongo como método normal de evento
'v1.0.0.187 21/Oct/20   Añadiendo opción para navegar entre las últimas poiciones.
'v1.0.0.188             Probando a ver si va con Dictionary(Integer, Marcadores)
'v1.0.0.189             Sigo con las pruebas
'v1.0.0.190             Seguir con la navegación y asignar al menú del botón el texto con la posición
'v1.0.0.191 22/Oct/20   A ver si esto de navegar va bien...
'v1.0.0.192             Añado campo cargando para usarlo mientras se cargan los ficheros.
'v1.0.0.193             Habilitando los botones de navegar.
'                       Uso Cargando al asignar la posición al navegar
'v1.0.0.194             Sigo con las comprobaciones de habilitar los botones
'v1.0.0.195             Repetía cada dos posiciones... a ver si ya lo he arreglado
'v1.0.0.196             Debería avanzar y retroceder de 1 en1 porque se salta posiciones
'v1.0.0.197             Probando con habilitar los botones
'v1.0.0.198             Ya funciona bien
'v1.0.0.199             Creo un método para habilitar los botones de navegar.
'v1.0.0.200             Asigno los menús de navegación (quito el botón anterior normal y dejo el de los menús)
'v1.0.0.201             Asigno com WithEvents todos las definiciones en MDIPrincipal, salvo los separadores
'v1.0.0.202             Asigno los menús a mostrar en el botón de navegar anterior
'v1.0.0.203             Poner el menú de navegar aparte del menú anterior
'v1.0.0.204             Ajustando detalles para que todo vaya bien al seleccionar del menú, etc.
'v1.0.0.205             El botón anterior siempre estará habilitado
'                       Hacer que al pulsar en el menú desplegable, vaya a donde tiene que ir
'v1.0.0.206             En ello estoy...
'v1.0.0.207             Ya funciona bien navegar y con el menú de navegación
'v1.0.0.208             A arreglar lo de los Bookmarks...
'v1.0.0.209 23/Oct/20   Cambiar la funcionalidad anterior pero usando la clase Marcadores
'v1.0.0.210             Añado métodos de Guardar y Leer configuración local
'v1.0.0.211             Cambio a Form1 los métodos Abrir(fic), Guardar, Guardar(fic), GuardarComo y Recargar
'v1.0.0.212             Elimino la variable NombreUltimoFichero, ahora se usará Form1Activo.nombreFichero
'v1.0.0.213             Probando si va bien...
'                       LeerConfigLocal: ponerlo en Abrir(fic) antes de abrir el fichero
'v1.0.0.214             La configuración se guarda en la carpeta DirConfiguracion
'                       Si no existe el directorio (estará en MyDocuments) se crea
'                       La configuración global se guarda separada de la de cada formulario
'v1.0.0.215             Asigno MostrarProcesando si al llamar a OnProcesando m_fProcesando es nulo
'v1.0.0.216             Probando con todo sin asignar, como si fuese la primera vez
'v1.0.0.217             Poniendo el fichero de configuración anterior en la carpeta
'v1.0.0.218             Usar una carpeta en el directorio de configuración
'                       para las configuraciones de los ficheros
'v1.0.0.219             Arreglar los bookmarks, se ponen en otra línea si no están al principio
'v1.0.0.220             Modifico la clase Marcadores para usar Inicio y SelStart en los bookmarks
'v1.0.0.221             Añado más funciones a la clase Marcadores
'v1.0.0.222             Se supone que ahora se posicionará en el sitio donde se marcó el marcador
'v1.0.0.223             Y más funciones a la clase Marcadores, a ver si ahora...
'v1.0.0.224             Para que funcione ir al siguiente o al anterior, las colecciones deben estar clasificadas
'v1.0.0.225             Añado el método Sort a la clase Bookmarks y clasifico las dos colecciones
'v1.0.0.226             Usando siempre PosicionActual0
'v1.0.0.227             Al activar la ventana, mostrar los botones que pueden estar habilitados
'v1.0.0.228             se comprueba si Bookmarks está asignado
'v1.0.0.229             Al asignar una nueva ventana, usar el valor cargando para colorear más rápido
'v1.0.0.230             Al crear un fichero nuevo Bookmarks no está asignado
'v1.0.0.231             Al activar la ventana actualizar el list de sintaxis
'v1.0.0.232             Si se ponen marcadores, al pulsar INTRO se quitan los marcadores...
'v1.0.0.233 24/Oct/20   Solucionar al poner el marcador que se posiciona el cursor en la línea anterior
'v1.0.0.234             Creo un método de extensión FindString para buscar en el texto del RichTextBox
'v1.0.0.235             Pero no hace falta usarlo, ya que no era fallo del Find era mío:
'                       escribí mal InitilizeComponent (InitializeComponent)
'v1.0.0.236             Al poner un marcador se queda en la misma posición que estaba
'                       al quitarlo se posiciona en la posición guardada por ese marcador
'v1.0.0.237             Al pulsar Ctrl+F le quita letras a la palabra seleccionada ???
'                       (por eso el fallo al buscar InitializeComponent)
'                       Es por lo de quitar la palabra Buscar... carácter por carácter... 
'v1.0.0.238             Arreglada la función QuitarPredeterminado
'v1.0.0.239             Después de cargar los ficheros, se actualiza el último formulario mostrado
'                       para que actualice correctamente los botones, etc.
'v1.0.0.240             Comprobar si al pegar texto se pierden los marcadores. Parece que está bien.
'v1.0.0.241             Al poner/quitar los marcadores repite línea. Solucionado.
'v1.0.0.242             Poner botones de marcadores para los del fichero actual y todos los marcadores.
'v1.0.0.243             Cambiar los métodos de MarcadorAnterior y MarcadorSiguiente para que sean fucniones
'                       y devuelvan False si llegaron al principio o final de los marcadores.
'v1.0.0.244             Operativas las opciones de ir al marcador anterior/siguiente de forma global
'v1.0.0.245             Usar totalBookmarks para saber los marcadores a nivel global que hay
'                       para saber si habilitar los botones/menús de ir a los marcadores globales
'v1.0.0.246             Ya está operativo el ir a los bookmarks globales
'                       antes fallaba si al ir al siguiente o anterior, esa ventana no tenía marcadores
'v1.0.0.247 25/Oct/20   Añado los estilos visuales a las propiedades del proyecto y
'                       añado la ubicación en github de este proyecto.
'v1.0.0.248 26/Oct/20   Comprobar porqué no colorea bien la selección: solucionado
'v1.0.0.249             Después de cargar los ficheros (al iniciarse la aplicación) activar directamente la ventana
'                       para que se muestren correctamente los botones (con BringToFront no va bien)
'v1.0.0.250             Nuevo intento de mover la ventana de dotnet al ejecutar el código
'v1.0.0.251             No hay forma de moverla, el truco es:
'                           al poner el cursor sobre la ventana en la barra de tareas
'                           se muestra un popup de la ventana, pulsar en la barra y darle a mover...
'v1.0.0.252             Arreglado BUG al cargar reciente (en recientes está el nombre del fichero sin path)
'v1.0.0.253             Pongo más elementos en la lista de recientes (25)
'v1.0.0.254             A ver si los cambios realizados van bien con el monitor externo
'                       (no lo han reparado, pero lo tengo)
'v1.0.0.255             Quito la llamada a Activate al final de LeerConfig
'v1.0.0.256             Pongo nuevamente el código para saber posición y tamaño del formulario principal
'v1.0.0.257             Solo se tiene en cuenta el Left para asignarle 0 si está fuera de la vista
'                       Top lo pongo a cero si es menor de cero
'v1.0.0.258             Arreglado BUG que en UltimasVentanasAbiertas guardaba el fichero sin el path
'v1.0.0.259 30/Oct/20   Se pueden indicar varios ficheros en la línea de comandos, de ser así,
'                       no se cargan los anteriores y no se guarda la lista de ficheros al cerrar.
'                       Esto lo hago así lo puedo usar para abrir varios ficheros
'                       que usaré para modificar sin que sean de los que quiero "recordar"
'v1.0.0.260             Al abrir desde la línea de comandos y al guardar todos se quedaba el form de progreso
'v1.0.0.261             Arreglado que al pegar, si no colorea, selecciona lo siguiente
'                       de donde se pegó
'v1.0.0.262             Al abrir, si es fichero de texto, no mostrar el panel de sintaxis
'v1.0.0.263             Al cerrar, si se pregunta guardar, usarlo para el resto de ficheros
'v1.0.0.264             Arreglado lo del pitido al pulsar ENTER y que ponga una línea de más
'                       si no estaba al principio de la línea
'v1.0.0.265             Para guardar todos (v...263) la variable guardarSinPreguntar
'                       la declaro compartida para que esté accesible a todos los formularios
'v1.0.0.266             Corregida la coparación para decidir si pregunta al guardar... estaba con OrElse
'                       después de comprobar guardarSinPreguntar
'v1.0.0.267             Se me escapó un detalle importante: ¡guardarlos! (cuando guardarSinPreguntar = True)
'v1.0.0.268             Al cargar desde la línea de comandos no muestra el fichero que carga...
'v1.0.0.269             El primer fichero en la línea de comandos será el ejecutable
'v1.0.0.270             Al quitar el monitor externo ya no se mostraba en su sitio
'v1.0.0.271             Si es texto está modificado, mostrar un asterisco en el texto de la ventana
'v1.0.0.272             Pongo lo del asterisco en menuVentana.DropDownOpening ya que si no se activa, no lo mostraría
'v1.0.0.273             Lo del asterisco lo pongo en TextoModificado
'v1.0.0.274             En Form1_Activate se asignaba nuevamente el nombre del fichero... ¡ain!
'v1.0.0.275             Al pulsar ENTER en el list de los recortes, aceptar ese texto
'v1.0.0.276             Al pegar desde Recortes, si es fichero de texto, no seleccionar (ya que se pierde lo pegado)
'v1.0.0.277             Al pegar, si el fichero está vacío, selectionStart es -1
'v1.0.0.278             Drag Drop no funciona... no estaba implementado en el richTexBoxCodigo
'v1.0.0.279             Al soltar ficheros con DragDrop poder cargar todos los soltados
'v1.0.0.280             También añado las operaciones de Drag Drop en el MDI
'v1.0.0.281 31/Oct/20   Al cargar ficheros desde la línea de comandos asigno cargando = True
'v1.0.0.282             Hago que la aplicación sea de instancia única (parece que ni caso)
'v1.0.0.283             Quito lo de instancia única, ya lo haré "manualmente"
'v1.0.0.284             Opción de cerrar todas las ventanas (ya estaba en el menú ventanas)
'                       pero lo dejo como opción en el menú ficheros
'v1.0.0.285             Deshabilitar los menús si no hay ventanas abiertas
'v1.0.0.286             Asigno imágenes a los menús de Ventana
'v1.0.0.287             Algunos cambios para que todo vaya mejor
'v1.0.0.288             Nueva opción de si se debe mostrar o no el diálogo de que no hay más coincidencias en la búsqueda
'v1.0.0.289             Que al no mostrar el diálogo de que no hay más coincidencias en la búsqueda no se culegue
'v1.0.0.290             No se guardaba en la configuración el valor de si se avisa cuando no haya más coincidencias
'v1.0.0.291             Quito algunas definiciones de UtilFormEditor y uso el acceso directo desde CurrentMDI
'v1.0.0.292             Arreglo bugs en FormOpciones y asigno los eventos con Handles
'v1.0.0.293             Comprobaciones al mostrar los menús de que haya formularios abiertos
'v1.0.0.294             Mostrar correctamente la ventana de aviso mientras se cargan de la línea de comandos
'v1.0.0.295             Habilitar los botones correctamente cuando no hay ventanas abiertas
'v1.0.0.296             Se puede usar una secuencia de pulsaciones (macro) y para usarlas pulsar CTRL+SHIFT+M
'v1.0.0.297             No usar la combinación de teclas Ctrl+Shift+M
'v1.0.0.298             Usar guardarSinPreguntar solo si se ha indicado al cerrar varias ventanas
'v1.0.0.299 01/Nov/20   Al cargar ficheros desde la línea de comandos, usar variosLineaComandos como máximo
'v1.0.0.300 02/Nov/20   Cambio el context menú del RichTextBoxCodigo al Form1 y
'                       quito del MDI también el context menú de la barra de estado
'v1.0.0.301 03/Nov/20   Uso FormatoEncoding para leer/guardar los ficheros. Uso Latin1 en vez de UTF8
'v1.0.0.302 06/Nov/20   Un poco de limpieza del código no usado, comentarios ya obsoletos, etc.
'v1.0.0.303             Quito algunas definciones de UtilFormEditor y las pongo en el form que corresponde
'v1.0.0.304             Pongo nueva opción para indicar si se debe o no habilitar la ejecución de la macro
'v1.0.0.305             Reviso los mensajes de aviso y solo dejo los que indican hacer métodos compartidos
'v1.0.0.306 11/Nov/20   Usando .NET 5.0 final en VS2019 v18.8.0 (no Preview)
'v1.0.0.307             Indico en Compilar las versiones de los directorios de .NET 5.0 final
'v1.0.0.308 26/Nov/20   Lo compilo con preferencia para 32bits-x86 (lo elimino)
'v1.0.0.309 27/Nov/20   Lo compilo con preferencia para 32bits-AnyCPU
'                       Para instalar en Windows 7 x86: Self-Contained y copio la carpeta publish en Win7 y ¡ok!
'v1.0.0.310             Quito los ficheros con link de Utilidades y añado los ficheros localmente
'                           CompararString, CompilarPartial, Compilar, Config, DiagClassifSpanInfo, Extensiones
'
'v1.0.1.0               Utilizo una referencia a gsUtilidadesNET que define las clases que estaban en la carpeta Utilidades
'v1.0.1.1               Comprobación de si está dotnet instalado, si no está no se puede compilar, evaluar ni colorear
'
'
'
'
' TODO:
'   20-oct  Colorear en segundo plano
'           Al cargar los ficheros al iniciar mostrar el primero que se abrió
'               y el resto, en modo oculto, seguirán cargando/coloreando.
'   17-oct  Solucionar lo del pitido al pulsar ENTER (creo que ya está)
'   04-oct  Usar plantillas y crearlas para usar con Nuevo...
'           Poder cargar un proyecto o solución con todos los ficheros relacionados
'